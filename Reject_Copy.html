<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OT Auto Approval</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 80px; }
    #msg { font-size: 18px; font-weight: bold; }
  </style>
</head>
<body>

  <div id="rejectBox">
    <h3>Reject Reason</h3>
    <textarea id="rejectComment" placeholder="Please enter reason..." required></textarea><br>
    <button class="reject" onclick="sendReject()">Submit Reject</button>
  </div>

  <div id="processBox" style="display: none;">
    <h2>Processing Request...</h2>
    <div id="msg">⏳ Sending...</div>
  </div>

  <script>
    const webhookUrl = "http://localhost:5678/webhook/ot-approval"; 

    // ✅ อ่านค่า parameter จาก URL
    const params = new URLSearchParams(window.location.search);
    const empId = params.get("id") || "UNKNOWN";
    const workDate = params.get("date") || new Date().toISOString().slice(0,10);
    const empName = params.get("name") || "UNKNOWN";
    const hours   = params.get("hours") || "";
    const Manage   = params.get("Manage") || "";

    function sendReject(){
      const comment = document.getElementById("rejectComment").value.trim();
      if (!comment) {
        alert("กรุณากรอกเหตุผลก่อน Reject");
        return;
      }

      // ✅ ยิง POST
      fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action: "reject",
          id: empId,
          date: workDate,
          name: empName,
          workingHour: hours,
          comment,
          Manage: Manage
        })
      })
      .then(res => res.text())   // หรือ res.json()
      .then(data => {
      document.getElementById("processBox").style.display = "block";
      document.getElementById("rejectBox").style.display = "none";
      document.getElementById("msg").innerText = "✅ Reject Success!";
    })
      .catch(err => {
      document.getElementById("msg").innerText = "❌ Error: " + err;
    });

    }
  </script>
</body>
</html>