<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reject OT Request</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f8;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    .card {
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 400px;
    }

    h2 {
      margin-bottom: 20px;
      color: #d9534f;
      font-size: 22px;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: none;
      margin-bottom: 20px;
    }

    button {
      background: #d9534f;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
    }

    button:hover {
      background: #c9302c;
    }

    #msg {
      margin-top: 15px;
      font-size: 14px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Reject Reason</h2>
    <textarea id="rejectComment" placeholder="กรุณากรอกเหตุผล..."></textarea>
    <button onclick="sendReject()">Submit Reject</button>
    <div id="msg"></div>
  </div>

  <script>
    // ✅ อ่านค่า parameter จาก URL
    const params   = new URLSearchParams(window.location.search);
    const empId    = params.get("id")    || "UNKNOWN";
    const workDate = params.get("date")  || new Date().toISOString().slice(0,10);
    const empName  = params.get("name")  || "UNKNOWN";
    const hours    = params.get("hours") || "";
    const Manage   = params.get("Manage")|| "";

    // ✅ URL webhook n8n
    const webhookUrl = "http://127.0.0.1:5678/webhook/ot-approval";

    function sendReject() {
      const comment = document.getElementById("rejectComment").value.trim();
      if (!comment) {
        document.getElementById("msg").innerText = "⚠️ กรุณากรอกเหตุผลก่อน Reject";
        return;
      }

      fetch(webhookUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action: "reject",
          id: empId,
          date: workDate,
          name: empName,
          workingHour: hours,
          comment,
          Manage: Manage
        })
      })
    .then(res => {
  if (res.ok) {
    document.getElementById("msg").innerHTML = "❌ Reject Success!";
  } else {
    document.getElementById("msg").innerText = "⚠️ Reject Failed!";
  }
})
.catch(err => {
  document.getElementById("msg").innerText = "❌ Error: " + err;
});
    }
  </script>
</body>
</html>